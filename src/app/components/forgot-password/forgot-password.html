<div class="flex items-center justify-center min-h-screen bg-gray-100 dark:bg-gray-800">
  <div class="bg-white dark:bg-gray-900 p-8 rounded-lg shadow-md w-full max-w-md">
    <!-- Username Step -->
    <div *ngIf="step === 'email'">
      <h2 class="text-2xl font-bold mb-6 text-center">Forgot Password</h2>
      <p class="text-gray-600 text-sm mb-4 text-center">
        Enter your username to receive a reset code.
      </p>
      <form (ngSubmit)="sendResetCode()" #emailForm="ngForm">
        <div class="mb-4">
          <label for="username" class="block text-gray-700">Username</label>
          <input type="text" id="username" [(ngModel)]="username" name="username" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="Enter your username">
        </div>
        <button type="submit" [disabled]="loading"
                class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 disabled:opacity-50 cursor-pointer">
          {{ loading ? 'Generating...' : 'Get Reset Code' }}
        </button>
      </form>
    </div>

    <!-- Code Verification Step -->
    <div *ngIf="step === 'code'">
      <h2 class="text-2xl font-bold mb-6 text-center">Verify Code</h2>
      <p class="text-gray-600 text-sm mb-4 text-center">
        Your reset code is: <strong class="text-blue-600 text-lg">{{ generatedCode }}</strong>
      </p>
      <form (ngSubmit)="verifyCode()" #codeForm="ngForm">
        <div class="mb-4">
          <label for="resetCode" class="block text-gray-700">Enter Reset Code</label>
          <input type="text" id="resetCode" [(ngModel)]="resetCode" name="resetCode" required
                 maxlength="4" pattern="[0-9]{4}"
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-2xl tracking-widest"
                 placeholder="0000">
        </div>
        <button type="submit"
                class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 cursor-pointer">
          Verify Code
        </button>
      </form>
      <p class="mt-4 text-center">
        <button (click)="resendCode()" [disabled]="loading"
                class="text-blue-500 hover:underline text-sm disabled:opacity-50">
          {{ loading ? 'Generating...' : 'Generate New Code' }}
        </button>
      </p>
    </div>

    <!-- Password Reset Step -->
    <div *ngIf="step === 'reset'">
      <h2 class="text-2xl font-bold mb-6 text-center">Reset Password</h2>
      <form (ngSubmit)="resetPassword()" #resetForm="ngForm">
        <div class="mb-4 relative">
          <label for="newPassword" class="block text-gray-700">New Password</label>
          <input [type]="showNewPassword ? 'text' : 'password'" id="newPassword" [(ngModel)]="newPassword" name="newPassword" required
                 minlength="6"
                 class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="Enter new password">
          <button type="button" (click)="toggleNewPasswordVisibility()"
                  class="absolute right-3 top-9 text-gray-500 hover:text-gray-700">
            {{ showNewPassword ? 'âŒ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <div class="mb-4 relative">
          <label for="confirmPassword" class="block text-gray-700">Confirm Password</label>
          <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" [(ngModel)]="confirmPassword" name="confirmPassword" required
                 class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="Confirm new password">
          <button type="button" (click)="toggleConfirmPasswordVisibility()"
                  class="absolute right-3 top-9 text-gray-500 hover:text-gray-700">
            {{ showConfirmPassword ? 'âŒ' : 'ğŸ‘ï¸' }}
          </button>
        </div>
        <button type="submit" [disabled]="loading"
                class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 disabled:opacity-50 cursor-pointer">
          {{ loading ? 'Resetting...' : 'Reset Password' }}
        </button>
      </form>
    </div>

    <!-- Messages -->
    <p *ngIf="message" class="mt-4 text-center" [ngClass]="step === 'reset' && message.includes('successfully') ? 'text-green-500' : 'text-red-500'">
      {{ message }}
    </p>

    <!-- Back to Login -->
    <p class="mt-4 text-center">
      <button (click)="backToLogin()" class="text-blue-500 hover:underline text-sm">
        Back to Login
      </button>
    </p>
  </div>
</div>